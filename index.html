<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Secret Santa!</title>
        <link rel="icon" type="image/x-icon" href="images/santa-icon.png">
        <link rel="stylesheet" href="styles.css">
    </head>
    <body>
        <main>
            <h1>Merry Christmas Santa!</h1>
            <div id="select-wrapper">
                <form id="myForm">
                    <label for="name" id="name-label">Select your name:</label>
                    <select name="name" id="name" required>
                        <option selected disabled value="select">Select Below</option>
                        <option id="chikuK" value="0">Chiku K</option>
                        <option id="teddy" value="1">Teddy</option>
                        <option id="kiyo" value="2">Kiyo</option>
                        <option id="obed" value="3">Obed</option>
                        <option id="chikuM" value="4">Chiku M</option>
                        <option id="jayla" value="5">Jayla</option>
                        <option id="jayden" value="6">Jayden</option>
                        <option id="phonso" value="7">Phonso</option>
                        <option id="jochebed" value="8">Jochebed</option>
                        <option id="wambui" value="9">Wambui</option>
                    </select>
                    <br>
                    <input type="submit" id="submit-btn">
                </form>
            </div>
            <div id="paper-header">

            </div>
            <div id="paper-container">
                <ul id="paper-list">
                    <!-- <li class="paper">Chiku</li>
                    <li class="paper">Teddy</li>  
                    <li class="paper">Jesus</li>
                    <li class="paper">Jochebed</li>
                    <li class="paper">Donut</li>
                    <li class="paper">Beaver</li>
                    <li class="paper">Napkin</li> -->
                </ul>
            </div>
        </main>
        <script type="module">
           
            import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
            
            
            const firebaseConfig = {
              apiKey: "AIzaSyCbIMXoB9nXwEECf-I5MxWw4JzU4ziXJQg",
              authDomain: "secret-santa-ef5e1.firebaseapp.com",
              databaseURL: "https://secret-santa-ef5e1-default-rtdb.firebaseio.com",
              projectId: "secret-santa-ef5e1",
              storageBucket: "secret-santa-ef5e1.firebasestorage.app",
              messagingSenderId: "275200184967",
              appId: "1:275200184967:web:2d100a66cc05fd1163de22",
              measurementId: "G-0X2LFTVNKN"
            };
          
            
            const app = initializeApp(firebaseConfig);
            //firebase.initializeApp(firebaseConfig); 
            
            import { getDatabase, get, remove, ref, child } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";

            const db = getDatabase();



            const submitBtn = document.getElementById("submit-btn");
            const dropDown = document.getElementById("name");
            let form = document.getElementById("myForm");
            let nameList = document.getElementById("paper-list");
            let hasSelected = false;
            let paperHeader = document.getElementById("paper-header");

            submitBtn.addEventListener("click", santaTime)
            form.addEventListener('submit', handleForm)


           

           function handleForm(event) {
            event.preventDefault();
           }

           function addItemsToList(santa) {
            let key = santa.key;
            let value = santa.val();
            

            
            let li = document.createElement("li");

            li.classList.add("paper");
            li.innerHTML = value.nameOfSanta;
            li.setAttribute("id", value.id);
            li.addEventListener("click", selectName)
            

            nameList.appendChild(li);
           }

           function addHeader() {
            let head = document.createElement("h2");
            head.classList.add("head");
            head.textContent = "Choose from one of the cards below!"

            paperHeader.appendChild(head);

           }


           function selectName(e) {
            if (!hasSelected) {
                if (dropDown.options[dropDown.selectedIndex].value == e.target.id) {
                    alert("You cannot choose yourself!")
                } else {
                    e.target.style.color = "black";
                    hasSelected = true;
                    removeData(e);
                }
            
            } else {
                alert("You may only select once!");
            }
                
           }

           function getNames() {

                const dbref = ref(db);
                let listOfNames = document.querySelectorAll(".paper");

                if (listOfNames.length == 0) {
                    get(child(dbref, 'names')).then((names) => {
                        names.forEach(santa => {
                            addItemsToList(santa);
                        })
                    })
                }
                
           }
           

            function santaTime() {
                addHeader();
                getNames();
            } 

            

            

            function removeData(e) {
                remove(ref(db, "names/" + e.target.id))
                .then(() => {
                    alert("Data removed");
                })
                .catch((error) => {
                    alert(error)
                });
            }

            function findData() {
                const dbref = ref(db);

                get(child(dbref, "names/" + random())) 
                .then((snapshot) => {
                    if (snapshot.exists()) {
                        output.classList.add("output-animation");
                        output.innerHTML = snapshot.val();
                        setTimeout(() => {
                            output.classList.remove("output-animation")}, 3000);
                    } else {
                        alert("Oops. Try again.")
                    }
                })
                .catch((error) => {
                    alert(error);
                })
            }

            
            //window.addEventListener("load", getNames);
            

          </script>
    </body>


</html>